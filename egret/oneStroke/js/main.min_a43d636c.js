var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);n.prototype=t.prototype,e.prototype=new n},__awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function l(e){try{a(r.next(e))}catch(t){i(t)}}function s(e){try{a(r["throw"](e))}catch(t){i(t)}}function a(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(l,s)}a((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,i&&(l=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(l=l.call(i,n[1])).done)return l;switch(i=0,l&&(n=[0,l.value]),n[0]){case 0:case 1:l=n;break;case 4:return a.label++,{value:n[1],done:!1};case 5:a.label++,i=n[1],n=[0];continue;case 7:n=a.ops.pop(),a.trys.pop();continue;default:if(l=a.trys,!(l=l.length>0&&l[l.length-1])&&(6===n[0]||2===n[0])){a=0;continue}if(3===n[0]&&(!l||n[1]>l[0]&&n[1]<l[3])){a.label=n[1];break}if(6===n[0]&&a.label<l[1]){a.label=l[1],l=n;break}if(l&&a.label<l[2]){a.label=l[2],a.ops.push(n);break}l[2]&&a.ops.pop(),a.trys.pop();continue}n=t.call(e,a)}catch(r){n=[6,r],i=0}finally{o=l=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,i,l,s,a={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.createView(),t}return __extends(t,e),t.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},t.prototype.onProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(e){egret.lifecycle.addLifecycleListener(function(e){e.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(e){console.log(e)})},t.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,this.loadResource()];case 1:return e.sent(),[4,this.createGameScene()];case 2:return e.sent(),[2]}})})},t.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),e=new LoadingUI,this.stage.addChild(e),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),[4,RES.loadGroup("preload",0,e)];case 2:return n.sent(),this.stage.removeChild(e),[3,4];case 3:return t=n.sent(),console.error(t),[3,4];case 4:return[2]}})})},t.prototype.createGameScene=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,RES.getResAsync("level_json")];case 1:return e=t.sent(),this.gameScene=new GameScene(e),this.addChild(this.gameScene),[2]}})})},t}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function e(){}return e.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,{nickName:"username"}]})})},e.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2]})})},e}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var CellEvent=function(e){function t(t,n,r){var o=e.call(this,t)||this;return o._row=n,o._col=r,o}return __extends(t,e),Object.defineProperty(t.prototype,"row",{get:function(){return this._row},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"col",{get:function(){return this._col},enumerable:!0,configurable:!0}),t.ADD_2_ARR="add2Arr",t.TRY_2_ADD_2_ARR="try2Add2Arr",t}(egret.Event);__reflect(CellEvent.prototype,"CellEvent");var Cell=function(e){function t(t,n,r,o,i){void 0===r&&(r=65),void 0===o&&(o=12);var l=e.call(this)||this;return l._row=t,l._col=n,l.size=r,l.ellipse=o,l._status=i,l.init(),l.once(egret.Event.REMOVED_FROM_STAGE,l.onRemoveFromStage,l),l}return __extends(t,e),t.prototype.init=function(){var e=this.graphics;e.beginFill(this._status>0?13684944:16777215),e.drawRoundRect(0,0,this.size,this.size,this.ellipse),e.endFill(),this._status>0&&(this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this))},t.prototype.onTouchBegin=function(){this.dispatchEvent(new CellEvent(CellEvent.TRY_2_ADD_2_ARR,this._row,this._col))},t.prototype.onTouchMove=function(){this.dispatchEvent(new CellEvent(CellEvent.ADD_2_ARR,this._row,this._col))},t.prototype.onRemoveFromStage=function(){this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this)},t}(egret.Shape);__reflect(Cell.prototype,"Cell");var GameScene=function(e){function t(t){var n=e.call(this)||this;return n._levelJson=t,n.cellArr=new Array,n.curLevel=1,n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n}return __extends(t,e),t.prototype.onAddToStage=function(){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.drawCell()},t.prototype.drawCell=function(){this.selectedRowAndCol=new Array,this.cellContainer||(this.cellContainer=new egret.DisplayObjectContainer);for(var e=null,n=0;n<this.cellArr.length;n++)for(var r=0;r<this.cellArr[0].length;r++)e=this.cellArr[n][r],e.removeEventListener(CellEvent.ADD_2_ARR,this.onAddCell2Arr,this),e.removeEventListener(CellEvent.TRY_2_ADD_2_ARR,this.onTry2AddCell2Arr,this),this.cellContainer.removeChild(e);this.cellArr.length=0;for(var o=this._levelJson[this.curLevel-1],i=o.length,l=o[0].length,n=0;i>n;n++){this.cellArr[n]=new Array;for(var r=0;l>r;r++)e=new Cell(n,r,t.CELL_SIZE,t.CELL_ELLIPSE,o[n][r]),e.x=r*(e.width+t.GAP),e.y=n*(e.height+t.GAP),this.cellContainer.addChild(e),this.cellArr[n][r]=e,e.addEventListener(CellEvent.ADD_2_ARR,this.onAddCell2Arr,this),e.addEventListener(CellEvent.TRY_2_ADD_2_ARR,this.onTry2AddCell2Arr,this),2===o[n][r]&&this.selectedRowAndCol.push({row:n,col:r})}this.cellContainer.x=(this.stage.stageWidth-this.cellContainer.width)/2,this.cellContainer.y=300,this.cellContainer.parent!==this&&this.addChild(this.cellContainer),this.selectedCellShape?this.cellContainer.setChildIndex(this.selectedCellShape,this.cellContainer.numChildren+1):(this.selectedCellShape=new egret.Shape,this.cellContainer.addChild(this.selectedCellShape)),this.drawSelectedCell()},t.prototype.drawSelectedCell=function(){for(var e=this,n=-1,r=-1,o=-1,i=-1,l=-1,s=-1,a=new Array,c=-1,h=0;h<this.selectedRowAndCol.length;h++)n=this.selectedRowAndCol[h].row,r=this.selectedRowAndCol[h].col,0===h&&(l=n,s=r),h<this.selectedRowAndCol.length-1?(o=this.selectedRowAndCol[h+1].row,i=this.selectedRowAndCol[h+1].col,-1===c?c=o===n?0:1:o===n?(1===c&&(a.push({startRow:l,startCol:s,endRow:n,endCol:r}),l=n,s=r),c=0):(0===c&&(a.push({startRow:l,startCol:s,endRow:n,endCol:r}),l=n,s=r),c=1)):a.push({startRow:l,startCol:s,endRow:n,endCol:r});var d=t.GAP,u=t.CELL_SIZE,f=this.selectedCellShape.graphics;f.clear(),f.beginFill(1626075);for(var _=0,p=0,v=0,w=0,h=0;h<a.length;h++){var C=a[h],g=C.startRow,A=C.startCol,R=C.endRow,y=C.endCol;g===R?(_=g,v=R,A>y?(p=y,w=A):(p=A,w=y)):(p=A,w=y,g>R?(_=R,v=g):(_=g,v=R)),f.drawRoundRect(p*(u+d),_*(u+d),(w-p)*d+(w-p+1)*u,(v-_)*d+(v-_+1)*u,t.CELL_ELLIPSE)}f.endFill();for(var E=this._levelJson[this.curLevel-1],m=E.length,S=E[0].length,b=!1,L=!0,T=0;m>T;T++){for(var D=0;S>D;D++){if(E[T][D]>0){b=!1;for(var h=0;h<this.selectedRowAndCol.length;h++)if(this.selectedRowAndCol[h].row===T&&this.selectedRowAndCol[h].col===D){b=!0;break}b||(L=!1)}if(!L)break}if(!L)break}if(L)var x=setTimeout(function(){clearTimeout(x),++e.curLevel>e._levelJson.length||e.drawCell()},200)},t.prototype.onTry2AddCell2Arr=function(e){for(var t=e.row,n=e.col,r=this.selectedRowAndCol.length,o=0;r>o;o++)if(this.selectedRowAndCol[o].row===t&&this.selectedRowAndCol[o].col===n)return this.selectedRowAndCol.splice(o,r-o),this.selectedRowAndCol.push({row:t,col:n}),void this.drawSelectedCell();if(r>0){var i=this.selectedRowAndCol[r-1].row,l=this.selectedRowAndCol[r-1].col;Math.abs(i-t)+Math.abs(l-n)===1&&(this.selectedRowAndCol.push({row:t,col:n}),this.drawSelectedCell())}},t.prototype.onAddCell2Arr=function(e){var t=e.row,n=e.col,r=this.selectedRowAndCol.length;if(r>0){var o=this.selectedRowAndCol[r-1].row,i=this.selectedRowAndCol[r-1].col;if(Math.abs(o-t)+Math.abs(i-n)!==1)return}for(var l=0;r>l;l++)if(this.selectedRowAndCol[l].row===t&&this.selectedRowAndCol[l].col===n)return;this.selectedRowAndCol.push({row:t,col:n}),this.drawSelectedCell()},t.GAP=12,t.CELL_SIZE=65,t.CELL_ELLIPSE=12,t}(egret.DisplayObjectContainer);__reflect(GameScene.prototype,"GameScene");var utils;!function(e){var t;!function(e){function t(e){var t=new egret.Bitmap;return t.texture=RES.getRes(e),t}e.create=t}(t=e.bitmap||(e.bitmap={}))}(utils||(utils={}));var utils;!function(e){var t;!function(e){function t(e,t){if(egret.Capabilities.runtimeType===egret.RuntimeType.WEB){var n=t||location.href;if(-1!=n.indexOf("?")){var r="&"+n.split("?")[1],o=new RegExp("&"+e+"=.*?(?:&|$)"),i=o.exec(r);if(i){var l=i[0];return l.split("&")[1].split("=")[1]}}}return null}e.getParamValue=t}(t=e.locationUtil||(e.locationUtil={}))}(utils||(utils={}));